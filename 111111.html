<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工工作状态与能力检测系统</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .card-hover {
                transition: transform 0.2s, box-shadow 0.2s;
            }
            .card-hover:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .gradient-mask {
                mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
                -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            }
            @keyframes valueChange {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
            .animate-value-change {
                animation: valueChange 0.5s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 transition-all duration-300 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- 品牌标识 -->
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center mr-3">
                            <i class="fa fa-line-chart text-white text-xl"></i>
                        </div>
                        <span class="text-xl font-bold text-gray-900">员工绩效系统</span>
                        <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">实时监控</span>
                    </div>
                </div>

                <!-- 中间搜索栏 -->
                <div class="hidden md:flex items-center flex-1 max-w-md mx-8">
                    <div class="relative w-full">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa fa-search text-gray-400"></i>
                        </div>
                        <input type="text" placeholder="搜索员工、部门或指标..."
                            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-300 focus:border-blue-500 transition duration-150 ease-in-out text-sm">
                    </div>
                </div>

                <!-- 右侧工具栏 -->
                <div class="flex items-center space-x-4">
                    <!-- 实时通知 -->
                    <div class="relative">
                        <button class="p-2 rounded-full text-gray-500 hover:text-blue-600 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-150 ease-in-out">
                            <i class="fa fa-bell-o text-lg"></i>
                            <span class="absolute top-0 right-0 block h-2.5 w-2.5 rounded-full bg-red-500 ring-2 ring-white" id="notification-badge"></span>
                        </button>
                    </div>

                    <!-- 数据刷新 -->
                    <button id="refresh-btn" class="p-2 rounded-full text-gray-500 hover:text-blue-600 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-150 ease-in-out">
                        <i class="fa fa-refresh text-lg"></i>
                    </button>

                    <!-- 编辑模式切换 -->
                    <div class="hidden md:flex items-center">
                        <span class="text-sm font-medium text-gray-700 mr-2" id="edit-mode-text">查看模式</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="edit-mode-toggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>

                    <!-- 用户菜单 -->
                    <div class="relative" id="user-menu-container">
                        <button id="user-menu-button" class="flex items-center max-w-xs rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-150 ease-in-out">
                            <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1005/40/40" alt="主管头像">
                            <span class="ml-2 hidden md:block text-sm font-medium text-gray-700">张主管</span>
                            <i class="fa fa-angle-down ml-1 text-gray-500 hidden md:block"></i>
                        </button>

                        <!-- 用户菜单下拉框 -->
                        <div id="user-menu" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 py-1 hidden z-50">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">个人资料</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">系统设置</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">使用帮助</a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">退出登录</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <div class="flex-1 flex overflow-hidden">
        <!-- 侧边导航 -->
        <aside class="w-64 bg-white border-r border-gray-200 hidden md:block transition-all duration-300 z-40">
            <div class="h-full flex flex-col">
                <!-- 导航菜单 -->
                <nav class="flex-1 px-2 py-4 space-y-1 overflow-y-auto scrollbar-hide">
                    <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-blue-600 bg-blue-50">
                        <i class="fa fa-dashboard mr-3 text-blue-600"></i>
                        数据总览
                    </a>
                    <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                        <i class="fa fa-users mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                        员工管理
                    </a>
                    <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                        <i class="fa fa-tasks mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                        任务跟踪
                    </a>
                    <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                        <i class="fa fa-bar-chart mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                        绩效分析
                    </a>
                    <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                        <i class="fa fa-lightbulb-o mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                        AI辅助评估
                    </a>

                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                            系统管理
                        </p>
                        <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                            <i class="fa fa-cog mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                            系统设置
                        </a>
                        <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                            <i class="fa fa-database mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                            数据管理
                        </a>
                        <a href="#" class="group flex items-center px-2 py-3 text-sm font-medium rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 transition duration-150 ease-in-out">
                            <i class="fa fa-shield mr-3 text-gray-500 group-hover:text-blue-600 transition duration-150 ease-in-out"></i>
                            权限控制
                        </a>
                    </div>
                </nav>

                <!-- 侧边栏底部 -->
                <div class="p-4 border-t border-gray-200">
                    <div class="bg-blue-50 rounded-lg p-3">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fa fa-info-circle text-blue-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-xs text-gray-700">
                                    系统版本: v1.0.0<br>
                                    实时更新中
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 主内容滚动区域 -->
        <main class="flex-1 overflow-y-auto bg-gray-50 p-4 md:p-6" id="main-content">
            <!-- 页面标题和状态信息 -->
            <div class="mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div>
                        <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-900">员工工作状态实时监控</h1>
                        <p class="mt-1 text-sm text-gray-500">
                            实时监控团队工作状态与能力水平 · 最后同步: <span id="last-sync-time" class="font-medium">加载中...</span>
                        </p>
                    </div>
                    <div class="mt-4 md:mt-0 flex space-x-3">
                        <button class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                            <i class="fa fa-download mr-2"></i> 导出报告
                        </button>
                        <button id="add-employee-btn" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                            <i class="fa fa-plus mr-2"></i> 新增员工
                        </button>
                    </div>
                </div>
            </div>

            <!-- 实时状态卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- 在线员工 -->
                <div class="bg-white rounded-xl p-5 card-shadow card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-500">在线员工</p>
                            <h3 class="mt-1 text-2xl font-bold text-gray-900" id="online-count">0</h3>
                            <div class="mt-2 flex items-center text-sm">
                                <span class="text-green-600 flex items-center">
                                    <i class="fa fa-arrow-up mr-1"></i> <span id="online-change">0</span>
                                </span>
                                <span class="ml-2 text-gray-500">较昨日</span>
                            </div>
                        </div>
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <i class="fa fa-user-circle text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-500">研发部</span>
                            <span class="font-medium" id="dev-online">0人</span>
                        </div>
                        <div class="flex items-center justify-between text-xs mt-1">
                            <span class="text-gray-500">市场部</span>
                            <span class="font-medium" id="marketing-online">0人</span>
                        </div>
                        <div class="flex items-center justify-between text-xs mt-1">
                            <span class="text-gray-500">销售部</span>
                            <span class="font-medium" id="sales-online">0人</span>
                        </div>
                    </div>
                </div>

                <!-- 任务完成率 -->
                <div class="bg-white rounded-xl p-5 card-shadow card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-500">平均任务完成率</p>
                            <h3 class="mt-1 text-2xl font-bold text-gray-900" id="task-completion">0%</h3>
                            <div class="mt-2 flex items-center text-sm">
                                <span class="text-green-600 flex items-center">
                                    <i class="fa fa-arrow-up mr-1"></i> <span id="completion-change">0%</span>
                                </span>
                                <span class="ml-2 text-gray-500">较上周</span>
                            </div>
                        </div>
                        <div class="p-3 bg-green-50 rounded-lg">
                            <i class="fa fa-check-square-o text-green-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full" id="completion-bar" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between mt-2 text-xs">
                            <span class="text-gray-500">目标: 85%</span>
                            <span class="text-green-600 font-medium" id="completion-status">需努力</span>
                        </div>
                    </div>
                </div>

                <!-- 平均能力评分 -->
                <div class="bg-white rounded-xl p-5 card-shadow card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-500">平均能力评分</p>
                            <h3 class="mt-1 text-2xl font-bold text-gray-900" id="avg-competence">0</h3>
                            <div class="mt-2 flex items-center text-sm">
                                <span class="text-green-600 flex items-center">
                                    <i class="fa fa-arrow-up mr-1"></i> <span id="competence-change">0</span>
                                </span>
                                <span class="ml-2 text-gray-500">较上月</span>
                            </div>
                        </div>
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <i class="fa fa-star text-yellow-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="flex items-center text-yellow-500 text-xs">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-half-o"></i>
                            <span class="ml-2 text-gray-500">满分100分</span>
                        </div>
                    </div>
                </div>

                <!-- 异常状态 -->
                <div class="bg-white rounded-xl p-5 card-shadow card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-500">需关注项</p>
                            <h3 class="mt-1 text-2xl font-bold text-gray-900" id="alert-count">0</h3>
                            <div class="mt-2 flex items-center text-sm">
                                <span class="text-red-600 flex items-center">
                                    <i class="fa fa-exclamation-circle mr-1"></i> 需要处理
                                </span>
                            </div>
                        </div>
                        <div class="p-3 bg-red-50 rounded-lg">
                            <i class="fa fa-bell text-red-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100 space-y-2">
                        <div class="flex items-center text-xs">
                            <span class="inline-flex items-center justify-center h-2 w-2 rounded-full bg-red-500 mr-2"></span>
                            <span class="text-gray-700">任务延期 (<span id="delayed-tasks">0</span>项)</span>
                        </div>
                        <div class="flex items-center text-xs">
                            <span class="inline-flex items-center justify-center h-2 w-2 rounded-full bg-yellow-500 mr-2"></span>
                            <span class="text-gray-700">效率下降 (<span id="low-efficiency">0</span>人)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 主要分析图表区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- 团队效率趋势图 -->
                <div class="bg-white rounded-xl p-5 card-shadow lg:col-span-2">
                    <div class="flex justify-between items-center mb-5">
                        <h3 class="text-lg font-semibold text-gray-900">团队效率趋势分析</h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 text-xs font-medium rounded-md bg-blue-600 text-white">日视图</button>
                            <button class="px-3 py-1 text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150 ease-in-out">周视图</button>
                            <button class="px-3 py-1 text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150 ease-in-out">月视图</button>
                        </div>
                    </div>
                    <div class="h-80">
                        <canvas id="efficiency-trend-chart"></canvas>
                    </div>
                </div>

                <!-- 能力分布雷达图 -->
                <div class="bg-white rounded-xl p-5 card-shadow">
                    <div class="flex justify-between items-center mb-5">
                        <h3 class="text-lg font-semibold text-gray-900">团队能力分布</h3>
                        <div class="relative">
                            <select id="department-filter" class="text-sm bg-gray-100 border-0 rounded-md py-1 pl-3 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-300 appearance-none">
                                <option value="all">全部门</option>
                                <option value="研发部">研发部</option>
                                <option value="市场部">市场部</option>
                                <option value="销售部">销售部</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                <i class="fa fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <div class="h-80 flex items-center justify-center">
                        <canvas id="competence-radar-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 员工列表和活动日志 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- 员工绩效列表 -->
                <div class="bg-white rounded-xl p-5 card-shadow lg:col-span-2">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-5">
                        <h3 class="text-lg font-semibold text-gray-900">员工绩效表现</h3>
                        <div class="mt-3 md:mt-0 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                            <div class="relative">
                                <select id="dept-filter" class="text-sm bg-gray-100 border-0 rounded-md py-2 pl-3 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-300 appearance-none">
                                    <option value="all">所有部门</option>
                                    <option value="研发部">研发部</option>
                                    <option value="市场部">市场部</option>
                                    <option value="销售部">销售部</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                    <i class="fa fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                            <div class="relative">
                                <select id="sort-filter" class="text-sm bg-gray-100 border-0 rounded-md py-2 pl-3 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-300 appearance-none">
                                    <option value="competence">按能力排序</option>
                                    <option value="completion">按任务完成率</option>
                                    <option value="name">按姓名</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                    <i class="fa fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-lg">
                                        员工信息
                                    </th>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        部门
                                    </th>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        状态
                                    </th>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        能力评分
                                    </th>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        任务完成率
                                    </th>
                                    <th scope="col" class="px-3 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">
                                        操作
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="employees-table">
                                <!-- 员工数据将通过JavaScript动态填充 -->
                                <tr>
                                    <td colspan="6" class="px-3 py-10 text-center text-gray-500">
                                        <i class="fa fa-spinner fa-spin mr-2"></i> 加载员工数据中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 实时活动日志 -->
                <div class="bg-white rounded-xl p-5 card-shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">实时活动日志</h3>
                        <button class="text-blue-600 hover:text-blue-700 transition duration-150 ease-in-out">
                            <i class="fa fa-refresh"></i>
                        </button>
                    </div>
                    <div class="space-y-4 max-h-96 overflow-y-auto scrollbar-hide gradient-mask" id="activity-log">
                        <!-- 活动日志将通过JavaScript动态填充 -->
                        <div class="flex items-center justify-center h-40 text-gray-500">
                            <i class="fa fa-spinner fa-spin mr-2"></i> 加载活动日志...
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 员工编辑模态框 -->
    <div id="employee-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-lg font-semibold text-gray-900" id="modal-title">添加新员工</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="employee-form">
                <input type="hidden" id="employee-id">
                <div class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">姓名</label>
                        <input type="text" id="name" name="name" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="position" class="block text-sm font-medium text-gray-700">职位</label>
                        <input type="text" id="position" name="position" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-700">部门</label>
                        <select id="department" name="department" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="研发部">研发部</option>
                            <option value="市场部">市场部</option>
                            <option value="销售部">销售部</option>
                        </select>
                    </div>
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700">工作状态</label>
                        <select id="status" name="status" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="工作中">工作中</option>
                            <option value="会议中">会议中</option>
                            <option value="休息中">休息中</option>
                            <option value="离线">离线</option>
                        </select>
                    </div>
                    <div>
                        <label for="competence_score" class="block text-sm font-medium text-gray-700">
                            能力评分: <span id="competence-value">70</span>/100
                        </label>
                        <input type="range" id="competence_score" name="competence_score" min="0" max="100" value="70"
                            class="mt-1 block w-full" oninput="document.getElementById('competence-value').textContent = this.value">
                    </div>
                    <div>
                        <label for="task_completion" class="block text-sm font-medium text-gray-700">
                            任务完成率: <span id="completion-value">0</span>%
                        </label>
                        <input type="range" id="task_completion" name="task_completion" min="0" max="100" value="0"
                            class="mt-1 block w-full" oninput="document.getElementById('completion-value').textContent = this.value">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
                    <button type="button" id="cancel-modal" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 通知提示框 -->
    <div id="notification-toast" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-sm transform translate-y-10 opacity-0 transition-all duration-300 z-50 hidden">
        <div class="flex">
            <div class="flex-shrink-0" id="toast-icon-container">
                <i class="fa fa-check-circle text-green-500 text-xl"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-gray-900" id="toast-title">操作成功</h3>
                <div class="mt-2 text-sm text-gray-500" id="toast-message">
                    您的修改已成功保存
                </div>
            </div>
            <button id="close-toast" class="ml-auto flex-shrink-0 text-gray-400 hover:text-gray-500">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // 全局变量
        let efficiencyChart, competenceChart;
        let editMode = false;
        let originalData = null;

        // DOM元素
        const elements = {
            editModeToggle: document.getElementById('edit-mode-toggle'),
            editModeText: document.getElementById('edit-mode-text'),
            refreshBtn: document.getElementById('refresh-btn'),
            lastSyncTime: document.getElementById('last-sync-time'),
            onlineCount: document.getElementById('online-count'),
            taskCompletion: document.getElementById('task-completion'),
            avgCompetence: document.getElementById('avg-competence'),
            alertCount: document.getElementById('alert-count'),
            notificationBadge: document.getElementById('notification-badge'),
            employeesTable: document.getElementById('employees-table'),
            activityLog: document.getElementById('activity-log'),
            addEmployeeBtn: document.getElementById('add-employee-btn'),
            employeeModal: document.getElementById('employee-modal'),
            modalContent: document.getElementById('modal-content'),
            modalTitle: document.getElementById('modal-title'),
            closeModal: document.getElementById('close-modal'),
            cancelModal: document.getElementById('cancel-modal'),
            employeeForm: document.getElementById('employee-form'),
            employeeId: document.getElementById('employee-id'),
            nameInput: document.getElementById('name'),
            positionInput: document.getElementById('position'),
            departmentInput: document.getElementById('department'),
            statusInput: document.getElementById('status'),
            competenceScoreInput: document.getElementById('competence_score'),
            taskCompletionInput: document.getElementById('task_completion'),
            competenceValue: document.getElementById('competence-value'),
            completionValue: document.getElementById('completion-value'),
            departmentFilter: document.getElementById('department-filter'),
            deptFilter: document.getElementById('dept-filter'),
            sortFilter: document.getElementById('sort-filter'),
            notificationToast: document.getElementById('notification-toast'),
            toastTitle: document.getElementById('toast-title'),
            toastMessage: document.getElementById('toast-message'),
            toastIconContainer: document.getElementById('toast-icon-container'),
            closeToast: document.getElementById('close-toast'),
            devOnline: document.getElementById('dev-online'),
            marketingOnline: document.getElementById('marketing-online'),
            salesOnline: document.getElementById('sales-online'),
            onlineChange: document.getElementById('online-change'),
            completionChange: document.getElementById('completion-change'),
            competenceChange: document.getElementById('competence-change'),
            completionBar: document.getElementById('completion-bar'),
            completionStatus: document.getElementById('completion-status'),
            delayedTasks: document.getElementById('delayed-tasks'),
            lowEfficiency: document.getElementById('low-efficiency')
        };

        // 初始化图表
        function initCharts() {
            // 团队效率趋势图
            const efficiencyCtx = document.getElementById('efficiency-trend-chart').getContext('2d');
            efficiencyChart = new Chart(efficiencyCtx, {
                type: 'line',
                data: {
                    labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                    datasets: [
                        {
                            label: '研发部',
                            data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#2563EB',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '市场部',
                            data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '销售部',
                            data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 10,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            padding: 10,
                            cornerRadius: 6
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // 能力分布雷达图
            const radarCtx = document.getElementById('competence-radar-chart').getContext('2d');
            competenceChart = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: [
                        '技术能力',
                        '沟通协作',
                        '问题解决',
                        '任务完成率',
                        '学习能力',
                        '创新思维'
                    ],
                    datasets: [{
                        label: '研发部',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563EB',
                        pointBackgroundColor: '#2563EB',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#2563EB'
                    }, {
                        label: '市场部',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10B981',
                        pointBackgroundColor: '#10B981',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#10B981'
                    }, {
                        label: '销售部',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(245, 158, 11, 0.2)',
                        borderColor: '#F59E0B',
                        pointBackgroundColor: '#F59E0B',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#F59E0B'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11
                                }
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        // 更新图表数据
        function updateCharts(employees) {
            // 按部门分组统计
            const deptData = {
                '研发部': { count: 0, competence: 0, completion: 0 },
                '市场部': { count: 0, competence: 0, completion: 0 },
                '销售部': { count: 0, competence: 0, completion: 0 }
            };

            employees.forEach(emp => {
                deptData[emp.department].count++;
                deptData[emp.department].competence += parseInt(emp.competence_score);
                deptData[emp.department].completion += parseInt(emp.task_completion);
            });

            // 计算平均值
            Object.keys(deptData).forEach(dept => {
                if (deptData[dept].count > 0) {
                    deptData[dept].competence = Math.round(deptData[dept].competence / deptData[dept].count);
                    deptData[dept].completion = Math.round(deptData[dept].completion / deptData[dept].count);
                }
            });

            // 更新效率趋势图 (模拟一天的数据变化)
            const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const now = new Date();
            const currentHour = now.getHours();
            const baseCompletion = {
                '研发部': deptData['研发部'].completion,
                '市场部': deptData['市场部'].completion,
                '销售部': deptData['销售部'].completion
            };

            // 为每个小时生成合理的完成率数据
            const datasets = hours.map((hour, index) => {
                const hourNum = parseInt(hour.split(':')[0]);
                let progress = 0;

                if (hourNum <= currentHour) {
                    // 工作时间内，完成率随时间增加
                    progress = Math.min(100, 20 + (index * 10));
                }

                return {
                    研发部: Math.min(100, baseCompletion['研发部'] * (0.8 + (progress / 100) * 0.4)),
                    市场部: Math.min(100, baseCompletion['市场部'] * (0.8 + (progress / 100) * 0.4)),
                    销售部: Math.min(100, baseCompletion['销售部'] * (0.8 + (progress / 100) * 0.4))
                };
            });

            // 更新图表数据
            efficiencyChart.data.datasets[0].data = datasets.map(d => Math.round(d['研发部']));
            efficiencyChart.data.datasets[1].data = datasets.map(d => Math.round(d['市场部']));
            efficiencyChart.data.datasets[2].data = datasets.map(d => Math.round(d['销售部']));
            efficiencyChart.update();

            // 更新雷达图 (模拟各能力值)
            competenceChart.data.datasets[0].data = [
                Math.round(baseCompletion['研发部'] * 1.1),  // 技术能力
                Math.round(baseCompletion['研发部'] * 0.9),  // 沟通协作
                Math.round(baseCompletion['研发部'] * 1.0),  // 问题解决
                baseCompletion['研发部'],                   // 任务完成率
                Math.round(baseCompletion['研发部'] * 0.95), // 学习能力
                Math.round(baseCompletion['研发部'] * 1.05)  // 创新思维
            ];

            competenceChart.data.datasets[1].data = [
                Math.round(baseCompletion['市场部'] * 0.85), // 技术能力
                Math.round(baseCompletion['市场部'] * 1.1),  // 沟通协作
                Math.round(baseCompletion['市场部'] * 1.0),  // 问题解决
                baseCompletion['市场部'],                    // 任务完成率
                Math.round(baseCompletion['市场部'] * 1.05), // 学习能力
                Math.round(baseCompletion['市场部'] * 1.0)   // 创新思维
            ];

            competenceChart.data.datasets[2].data = [
                Math.round(baseCompletion['销售部'] * 0.75), // 技术能力
                Math.round(baseCompletion['销售部'] * 1.15), // 沟通协作
                Math.round(baseCompletion['销售部'] * 0.95), // 问题解决
                baseCompletion['销售部'],                    // 任务完成率
                Math.round(baseCompletion['销售部'] * 0.9),  // 学习能力
                Math.round(baseCompletion['销售部'] * 1.0)   // 创新思维
            ];

            competenceChart.update();
        }

        // 过滤和排序员工数据
        function filterAndSortEmployees(employees) {
            let filtered = [...employees];

            // 部门过滤
            const deptFilter = elements.deptFilter.value;
            if (deptFilter !== 'all') {
                filtered = filtered.filter(emp => emp.department === deptFilter);
            }

            // 排序
            const sortBy = elements.sortFilter.value;
            filtered.sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name);
                } else if (sortBy === 'competence') {
                    return parseInt(b.competence_score) - parseInt(a.competence_score);
                } else { // completion
                    return parseInt(b.task_completion) - parseInt(a.task_completion);
                }
            });

            return filtered;
        }

        // 更新员工表格
        function updateEmployeesTable(employees) {
            const filteredEmployees = filterAndSortEmployees(employees);

            if (filteredEmployees.length === 0) {
                elements.employeesTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-3 py-10 text-center text-gray-500">
                            没有找到匹配的员工数据
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            filteredEmployees.forEach(emp => {
                // 确定状态样式
                let statusClass = '';
                let statusIcon = '';

                if (emp.status === '工作中') {
                    statusClass = 'bg-green-100 text-green-800';
                    statusIcon = 'bg-green-500';
                } else if (emp.status === '会议中') {
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    statusIcon = 'bg-yellow-500';
                } else if (emp.status === '休息中') {
                    statusClass = 'bg-blue-100 text-blue-800';
                    statusIcon = 'bg-blue-500';
                } else {
                    statusClass = 'bg-gray-100 text-gray-800';
                    statusIcon = 'bg-gray-400';
                }

                html += `
                <tr class="hover:bg-gray-50 transition duration-150 ease-in-out">
                    <td class="px-3 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 relative">
                                <img class="h-10 w-10 rounded-full object-cover" src="https://picsum.photos/id/${1000 + parseInt(emp.id)}/50/50" alt="${emp.name}">
                                <span class="absolute bottom-0 right-0 h-3 w-3 rounded-full ${statusIcon} border-2 border-white"></span>
                            </div>
                            <div class="ml-3">
                                <div class="text-sm font-medium text-gray-900">${emp.name}</div>
                                <div class="text-xs text-gray-500">${emp.position}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${emp.department}</div>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">${emp.status}</span>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: ${emp.competence_score}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900">${emp.competence_score}</span>
                        </div>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: ${emp.task_completion}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900">${emp.task_completion}%</span>
                        </div>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-700 transition duration-150 ease-in-out view-employee" data-id="${emp.id}">
                                <i class="fa fa-eye"></i>
                            </button>
                            <button class="text-yellow-500 hover:text-yellow-600 transition duration-150 ease-in-out edit-employee" data-id="${emp.id}" ${!editMode ? 'disabled' : ''}>
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-700 transition duration-150 ease-in-out delete-employee" data-id="${emp.id}" data-name="${emp.name}" ${!editMode ? 'disabled' : ''}>
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            });

            elements.employeesTable.innerHTML = html;

            // 添加事件监听器
            document.querySelectorAll('.edit-employee').forEach(btn => {
                btn.addEventListener('click', () => editEmployee(btn.dataset.id));
            });

            document.querySelectorAll('.delete-employee').forEach(btn => {
                btn.addEventListener('click', () => deleteEmployee(btn.dataset.id, btn.dataset.name));
            });

            document.querySelectorAll('.view-employee').forEach(btn => {
                btn.addEventListener('click', () => viewEmployee(btn.dataset.id));
            });
        }

        // 更新活动日志
        function updateActivityLog(activities) {
            if (activities.length === 0) {
                elements.activityLog.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        暂无活动记录
                    </div>
                `;
                return;
            }

            let html = '';
            activities.forEach(activity => {
                // 格式化时间
                const timestamp = new Date(activity.timestamp);
                const now = new Date();
                const diffMs = now - timestamp;
                const diffMins = Math.floor(diffMs / 60000);
                let timeString = '';

                if (diffMins < 1) {
                    timeString = '刚刚';
                } else if (diffMins < 60) {
                    timeString = `${diffMins}分钟前`;
                } else if (diffMins < 1440) {
                    timeString = `${Math.floor(diffMins / 60)}小时前`;
                } else {
                    timeString = `${Math.floor(diffMins / 1440)}天前`;
                }

                // 确定活动类型和图标
                let iconClass = '';
                let bgClass = '';

                if (activity.action.includes('完成') || activity.action.includes('更新至 100%')) {
                    iconClass = 'fa fa-check text-green-600';
                    bgClass = 'bg-green-50';
                } else if (activity.action.includes('提升') || activity.action.includes('更新至')) {
                    iconClass = 'fa fa-star text-blue-600';
                    bgClass = 'bg-blue-50';
                } else if (activity.action.includes('延期') || activity.action.includes('下降')) {
                    iconClass = 'fa fa-exclamation text-red-600';
                    bgClass = 'bg-red-50';
                } else if (activity.action.includes('加入') || activity.action.includes('新增')) {
                    iconClass = 'fa fa-user-plus text-purple-600';
                    bgClass = 'bg-purple-50';
                } else if (activity.action.includes('状态已变为')) {
                    iconClass = 'fa fa-refresh text-yellow-600';
                    bgClass = 'bg-yellow-50';
                } else {
                    iconClass = 'fa fa-info text-gray-600';
                    bgClass = 'bg-gray-50';
                }

                html += `
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-8 w-8 rounded-full ${bgClass} flex items-center justify-center mt-1">
                        <i class="${iconClass} text-xs"></i>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm text-gray-800"><span class="font-medium">${activity.employee}</span> ${activity.action}</p>
                        <p class="text-xs text-gray-500 mt-0.5">${timeString}</p>
                    </div>
                </div>
                `;
            });

            elements.activityLog.innerHTML = html;
        }

        // 更新部门在线人数统计
        function updateDepartmentOnlineStats(employees) {
            const deptOnline = {
                '研发部': 0,
                '市场部': 0,
                '销售部': 0
            };

            employees.forEach(emp => {
                if (emp.status === '工作中' || emp.status === '会议中') {
                    deptOnline[emp.department]++;
                }
            });

            elements.devOnline.textContent = `${deptOnline['研发部']}人`;
            elements.marketingOnline.textContent = `${deptOnline['市场部']}人`;
            elements.salesOnline.textContent = `${deptOnline['销售部']}人`;

            // 模拟变化值
            elements.onlineChange.textContent = '3';
            elements.completionChange.textContent = '5%';
            elements.competenceChange.textContent = '2.1';
        }

        // 更新异常状态统计
        function updateAlertStats(employees) {
            let delayedTasks = 0;
            let lowEfficiency = 0;

            employees.forEach(emp => {
                if (emp.task_completion < 60) {
                    delayedTasks++;
                }
                if (emp.competence_score < 70) {
                    lowEfficiency++;
                }
            });

            elements.delayedTasks.textContent = delayedTasks;
            elements.lowEfficiency.textContent = lowEfficiency;
        }

        // 更新完成率状态
        function updateCompletionStatus(completionRate) {
            elements.completionBar.style.width = `${completionRate}%`;

            if (completionRate >= 85) {
                elements.completionStatus.textContent = '已达标';
                elements.completionStatus.className = 'text-green-600 font-medium';
            } else if (completionRate >= 70) {
                elements.completionStatus.textContent = '接近目标';
                elements.completionStatus.className = 'text-yellow-600 font-medium';
            } else {
                elements.completionStatus.textContent = '需努力';
                elements.completionStatus.className = 'text-red-600 font-medium';
            }
        }

        // 显示通知提示
        function showToast(title, message, type = 'success') {
            elements.toastTitle.textContent = title;
            elements.toastMessage.textContent = message;

            // 设置图标
            let iconClass = '';
            switch(type) {
                case 'success':
                    iconClass = 'fa fa-check-circle text-green-500 text-xl';
                    break;
                case 'error':
                    iconClass = 'fa fa-exclamation-circle text-red-500 text-xl';
                    break;
                case 'warning':
                    iconClass = 'fa fa-warning text-yellow-500 text-xl';
                    break;
                case 'info':
                    iconClass = 'fa fa-info-circle text-blue-500 text-xl';
                    break;
            }
            elements.toastIconContainer.innerHTML = `<i class="${iconClass}"></i>`;

            // 显示提示框
            elements.notificationToast.classList.remove('hidden');
            setTimeout(() => {
                elements.notificationToast.classList.remove('translate-y-10', 'opacity-0');
            }, 10);

            // 3秒后自动关闭
            setTimeout(hideToast, 3000);
        }

        // 隐藏通知提示
        function hideToast() {
            elements.notificationToast.classList.add('translate-y-10', 'opacity-0');
            setTimeout(() => {
                elements.notificationToast.classList.add('hidden');
            }, 300);
        }

        // 打开模态框
        function openModal() {
            elements.employeeModal.classList.remove('hidden');
            setTimeout(() => {
                elements.modalContent.classList.remove('scale-95', 'opacity-0');
                elements.modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // 关闭模态框
        function closeModal() {
            elements.modalContent.classList.remove('scale-100', 'opacity-100');
            elements.modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                elements.employeeModal.classList.add('hidden');
                elements.employeeForm.reset();
                elements.employeeId.value = '';
                elements.competenceValue.textContent = '70';
                elements.completionValue.textContent = '0';
            }, 300);
        }

        // 编辑员工
        function editEmployee(empId) {
            // 查找员工数据
            const employee = originalData.employees.find(emp => emp.id == empId);
            if (!employee) return;

            // 填充表单
            elements.modalTitle.textContent = `编辑员工: ${employee.name}`;
            elements.employeeId.value = employee.id;
            elements.nameInput.value = employee.name;
            elements.positionInput.value = employee.position;
            elements.departmentInput.value = employee.department;
            elements.statusInput.value = employee.status;
            elements.competenceScoreInput.value = employee.competence_score;
            elements.taskCompletionInput.value = employee.task_completion;
            elements.competenceValue.textContent = employee.competence_score;
            elements.completionValue.textContent = employee.task_completion;

            // 打开模态框
            openModal();
        }

        // 查看员工详情
        function viewEmployee(empId) {
            // 查找员工数据
            const employee = originalData.employees.find(emp => emp.id == empId);
            if (!employee) return;

            // 这里可以实现查看员工详情的功能
            showToast('员工详情', `${employee.name} - ${employee.position} (${employee.department})`, 'info');
        }

        // 删除员工
        function deleteEmployee(empId, empName) {
            if (!confirm(`确定要删除员工 ${empName} 吗？`)) return;

            // 发送删除请求
            fetch(`/api/employee/${empId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('删除成功', `员工 ${empName} 已被删除`);
                } else {
                    showToast('删除失败', '操作过程中出现错误', 'error');
                }
            })
            .catch(error => {
                console.error('Error deleting employee:', error);
                showToast('删除失败', '网络错误，请重试', 'error');
            });
        }

        // 提交员工表单
        function submitEmployeeForm(event) {
            event.preventDefault();

            const formData = {
                name: elements.nameInput.value,
                position: elements.positionInput.value,
                department: elements.departmentInput.value,
                status: elements.statusInput.value,
                competence_score: parseInt(elements.competenceScoreInput.value),
                task_completion: parseInt(elements.taskCompletionInput.value)
            };

            const empId = elements.employeeId.value;
            const isEdit = !!empId;
            const url = isEdit ? `/api/employee/${empId}` : '/api/employee';
            const method = isEdit ? 'PUT' : 'POST';

            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal();
                    showToast(
                        isEdit ? '更新成功' : '添加成功',
                        isEdit ? `员工 ${formData.name} 信息已更新` : `已成功添加员工 ${formData.name}`
                    );
                } else {
                    showToast('操作失败', '保存过程中出现错误', 'error');
                }
            })
            .catch(error => {
                console.error('Error saving employee:', error);
                showToast('操作失败', '网络错误，请重试', 'error');
            });
        }

        // 更新仪表板数据
        function updateDashboard(data) {
            // 保存原始数据
            originalData = data;

            // 更新基本统计
            elements.lastSyncTime.textContent = data.last_updated;
            elements.onlineCount.textContent = data.online_employees;
            elements.taskCompletion.textContent = `${data.avg_completion}%`;
            elements.avgCompetence.textContent = data.avg_competence;
            elements.alertCount.textContent = data.alert_count;
            elements.notificationBadge.textContent = data.activities.length;

            // 更新部门在线人数
            updateDepartmentOnlineStats(data.employees);

            // 更新异常状态统计
            updateAlertStats(data.employees);

            // 更新完成率状态
            updateCompletionStatus(data.avg_completion);

            // 更新员工表格
            updateEmployeesTable(data.employees);

            // 更新活动日志
            updateActivityLog(data.activities);

            // 更新图表
            updateCharts(data.employees);
        }

        // 初始化应用
        function initApp() {
            // 初始化图表
            initCharts();

            // 加载初始数据
            fetch('/api/dashboard')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    showToast('加载失败', '无法获取数据，请刷新页面重试', 'error');
                });

            // 连接WebSocket
            const socket = io();

            socket.on('connect', () => {
                console.log('Connected to server');
            });

            socket.on('initial_data', (data) => {
                updateDashboard(data);
            });

            socket.on('data_updated', (data) => {
                updateDashboard(data);
                // 为更新的数据添加动画效果
                elements.onlineCount.classList.add('animate-value-change');
                elements.taskCompletion.classList.add('animate-value-change');
                elements.avgCompetence.classList.add('animate-value-change');
                elements.alertCount.classList.add('animate-value-change');

                setTimeout(() => {
                    elements.onlineCount.classList.remove('animate-value-change');
                    elements.taskCompletion.classList.remove('animate-value-change');
                    elements.avgCompetence.classList.remove('animate-value-change');
                    elements.alertCount.classList.remove('animate-value-change');
                }, 1000);
            });

            // 事件监听器
            elements.editModeToggle.addEventListener('change', () => {
                editMode = elements.editModeToggle.checked;
                elements.editModeText.textContent = editMode ? '编辑模式' : '查看模式';

                // 更新编辑按钮状态
                document.querySelectorAll('.edit-employee, .delete-employee').forEach(btn => {
                    if (editMode) {
                        btn.removeAttribute('disabled');
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        btn.setAttribute('disabled', 'true');
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                });

                showToast('模式切换', editMode ? '已进入编辑模式，可以修改员工信息' : '已进入查看模式，无法编辑内容', 'info');
            });

            elements.refreshBtn.addEventListener('click', () => {
                // 添加旋转动画
                elements.refreshBtn.querySelector('i').classList.add('fa-spin');

                // 刷新数据
                fetch('/api/dashboard')
                    .then(response => response.json())
                    .then(data => {
                        updateDashboard(data);
                        elements.refreshBtn.querySelector('i').classList.remove('fa-spin');
                        showToast('刷新成功', '数据已更新至最新状态');
                    })
                    .catch(error => {
                        console.error('Error refreshing data:', error);
                        elements.refreshBtn.querySelector('i').classList.remove('fa-spin');
                        showToast('刷新失败', '无法更新数据，请重试', 'error');
                    });
            });

            elements.addEmployeeBtn.addEventListener('click', () => {
                if (!editMode) {
                    showToast('操作提示', '请先切换到编辑模式', 'warning');
                    return;
                }

                elements.modalTitle.textContent = '添加新员工';
                elements.employeeForm.reset();
                elements.employeeId.value = '';
                elements.competenceScoreInput.value = 70;
                elements.taskCompletionInput.value = 0;
                elements.competenceValue.textContent = '70';
                elements.completionValue.textContent = '0';
                openModal();
            });

            elements.closeModal.addEventListener('click', closeModal);
            elements.cancelModal.addEventListener('click', closeModal);
            elements.employeeForm.addEventListener('submit', submitEmployeeForm);
            elements.closeToast.addEventListener('click', hideToast);

            // 过滤和排序事件
            elements.deptFilter.addEventListener('change', () => {
                if (originalData) {
                    updateEmployeesTable(originalData.employees);
                }
            });

            elements.sortFilter.addEventListener('change', () => {
                if (originalData) {
                    updateEmployeesTable(originalData.employees);
                }
            });

            elements.departmentFilter.addEventListener('change', () => {
                // 可以在这里实现按部门过滤雷达图数据
                if (originalData) {
                    updateCharts(originalData.employees);
                }
            });

            // 用户菜单切换
            document.getElementById('user-menu-button').addEventListener('click', () => {
                document.getElementById('user-menu').classList.toggle('hidden');
            });

            // 点击外部关闭用户菜单
            document.addEventListener('click', (e) => {
                if (!document.getElementById('user-menu-container').contains(e.target)) {
                    document.getElementById('user-menu').classList.add('hidden');
                }
            });
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
